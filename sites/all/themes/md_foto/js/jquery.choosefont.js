(function(e){e.fn.choosefont=function(){return this.each(function(){function o(t,i,s,o){t=typeof t!=="undefined"?t:e("#dk_container_"+n+"-fontfamily .dk_option_current a").attr("data-dk-dropdown-value");i=typeof i!=="undefined"?i:e("#dk_container_"+n+"-fontweight .dk_option_current a").attr("data-dk-dropdown-value");s=typeof s!=="undefined"?s:e("#"+n+"-fontsize").val();o=typeof o!=="undefined"?o:e("#dk_container_"+n+"-sizetype .dk_option_current a").attr("data-dk-dropdown-value");_fontfamilydetail=Drupal.settings.font_vars[t].CSS;e(r).val(t+"|"+i+"|"+s+"|"+o+"|"+_fontfamilydetail)}function u(t){_fontfamily=e("#dk_container_"+t+"-fontfamily .dk_option_current a").attr("data-dk-dropdown-value");_fontweight=e("#dk_container_"+t+"-fontweight .dk_option_current a").attr("data-dk-dropdown-value");_fontsize=e("#"+t+"-fontsize").val();_sizetype=e("#dk_container_"+t+"-sizetype .dk_option_current a").attr("data-dk-dropdown-value");_color="#"+e("#"+t).next().find("input.form-colorpicker").val();_fontweightarr=_fontweight.split("");if(_fontweightarr[0]=="i"){_fontweightarr[0]="italic"}else{_fontweightarr[0]="normal"}_fontfamilydetail=Drupal.settings.font_vars[_fontfamily].CSS;e("#preview-"+t+" .tp-textdemo").css({"font-family":_fontfamilydetail,"font-weight":_fontweightarr[1]+"00","font-style":_fontweightarr[0],"font-size":_fontsize+_sizetype,color:_color})}function a(e,t){switch(e){case"n1":fontExpand="Thin";break;case"i1":fontExpand="Thin Italic";break;case"n2":fontExpand="Extra Light";break;case"i2":fontExpand="Extra Light Italic";break;case"n3":fontExpand="Light";break;case"i3":fontExpand="Light Italic";break;case"n4":fontExpand="Normal";break;case"i4":fontExpand="Italic";break;case"n5":fontExpand="Medium";break;case"i5":fontExpand="Medium Italic";break;case"n6":fontExpand="Semi Bold";break;case"i6":fontExpand="Semi Bold Italic";break;case"n7":fontExpand="Bold";break;case"i7":fontExpand="Bold Italic";break;case"n8":fontExpand="Extra Bold";break;case"i8":fontExpand="Extra Bold Italic";break;case"n9":fontExpand="Heavy";break;case"i9":fontExpand="Heavy Italic";break;default:fontExpand="undefined"}return fontExpand}var t=e(this),n=t.attr("id"),r="input[name="+n.replace(/-/g,"_")+"]",i="",s=1;data_arr=e(r).val().split("|");data_arr[0]=typeof data_arr[0]!=="undefined"?data_arr[0]:"0";if(!data_arr[0])data_arr[0]="0";data_arr[1]=typeof data_arr[1]!=="undefined"?data_arr[1]:"n4";data_arr[2]=typeof data_arr[2]!=="undefined"?data_arr[2]:"";data_arr[3]=typeof data_arr[3]!=="undefined"?data_arr[3]:"px";if(!Drupal.settings.font_vars[data_arr[0]]){data_arr[0]="1"}html='<div class="form-font"><label>Font</label>';html+='<select id="'+n+'-fontfamily" class="form-select2">';e.each(Drupal.settings.font_array,function(e,t){if(e==data_arr[0]){_select=' selected="selected"'}else{_select=""}html+="<option"+_select+' value="'+e+'">'+t+"</option>"});html+="</select>";html+='<div id="fontweight-'+n+'" class="form-font-weight"></div>';html+='<div class="form-font-size"><input type="text" maxlength="128" size="60" value="'+data_arr[2]+'" id="'+n+'-fontsize" class="font-size form-text" /></div>';html+='<select id="'+n+'-sizetype" class="form-select2">';if(data_arr[3]=="em"){html+='<option value="px">px</option><option selected="selected" value="em">em</option>'}else{html+='<option value="px">px</option><option value="em">em</option>'}html+="</select></div>";t.prepend(html);i=data_arr[0];fontweight_html='<select id="'+n+'-fontweight" class="form-select3">';fontweight_arr=Drupal.settings.font_vars[i].Weight.split(",");e.each(fontweight_arr,function(t,n){optval=e.trim(n);if(optval==data_arr[1]){_select=' selected="selected"'}else{_select=""}fontweight_html+="<option"+_select+' value="'+optval+'">'+a(optval)+"</option>"});fontweight_html+="</select>";e("#fontweight-"+n).html(fontweight_html);e("#fontweight-"+n+" select").dropkick();e(".form-select2").dropkick();t.next().addClass("withpreviewbtn").append('<div id="previewbtn-'+n+'" class="previewbtn"><a href="#">Preview</a></div>');t.parent().append('<div id="preview-'+n+'" class="textpreview"><div class="tp-textdemo">Grumpy wizards make toxic brew for the evil Queen and Jack.</div><a href="#" class="tp-close">Close preview</a></div>');e("#previewbtn-"+n+" a").click(function(){u(n);e("#preview-"+n).show();e(this).text("Refresh").addClass("pbtn-refresh");return false});e("#preview-"+n+" .tp-close").click(function(){e(this).parent().hide();e("#previewbtn-"+n+" a").text("Preview").removeClass("pbtn-refresh");return false});e("#dk_container_"+n+"-fontfamily .dk_options_inner a").each(function(){e(this).click(function(){i=e(this).attr("data-dk-dropdown-value");fontweight_html='<select id="'+n+'-fontweight" class="form-select3">';fontweight_arr=Drupal.settings.font_vars[i].Weight.split(",");e.each(fontweight_arr,function(t,n){optval=e.trim(n);fontweight_html+='<option value="'+optval+'">'+a(optval)+"</option>"});fontweight_html+="</select>";e("#fontweight-"+n).html(fontweight_html);e("#fontweight-"+n+" select").dropkick();s=1;o(i)})});e("#dk_container_"+n+"-fontweight").live("mouseenter",function(){if(s!=0){e(this).find(".dk_options_inner a").each(function(){e(this).click(function(){fontweightval=e(this).attr("data-dk-dropdown-value");i=e("#dk_container_"+n+"-fontfamily .dk_option_current a").attr("data-dk-dropdown-value");o(i,fontweightval)})});s=0}});e("#"+n+"-fontsize").bind("keydown",function(t){if(t.keyCode==13){i=e("#dk_container_"+n+"-fontfamily .dk_option_current a").attr("data-dk-dropdown-value");fontweightval=e("#dk_container_"+n+"-fontweight .dk_option_current a").attr("data-dk-dropdown-value");fontsizeval=e(this).val();o(i,fontweightval,fontsizeval);return false}}).focusout(function(){i=e("#dk_container_"+n+"-fontfamily .dk_option_current a").attr("data-dk-dropdown-value");fontweightval=e("#dk_container_"+n+"-fontweight .dk_option_current a").attr("data-dk-dropdown-value");fontsizeval=e(this).val();o(i,fontweightval,fontsizeval)});e("#dk_container_"+n+"-sizetype .dk_options_inner a").each(function(){e(this).click(function(){i=e("#dk_container_"+n+"-fontfamily .dk_option_current a").attr("data-dk-dropdown-value");fontweightval=e("#dk_container_"+n+"-fontweight .dk_option_current a").attr("data-dk-dropdown-value");fontsizeval=e("#"+n+"-fontsize").val();sizetypeval=e(this).attr("data-dk-dropdown-value");o(i,fontweightval,fontsizeval,sizetypeval)})});e(document).bind("keydown",function(t){var r=e(".dk_container.dk_open"),s=e(".dk_container.dk_focus"),u=null;if(r.length){u=r}else if(s.length&&!r.length){u=s}if(t.keyCode==13&&u){i=e("#dk_container_"+n+"-fontfamily .dk_option_current a").attr("data-dk-dropdown-value");fontweightval=e("#dk_container_"+n+"-fontweight .dk_option_current a").attr("data-dk-dropdown-value");fontsizeval=e("#"+n+"-fontsize").val();sizetypeval=e("#dk_container_"+n+"-fontsize .dk_option_current a").attr("data-dk-dropdown-value");o(i,fontweightval,fontsizeval,sizetypeval)}})})}})(jQuery)